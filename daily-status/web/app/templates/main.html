{% extends 'base.html' %}

{% block title %}Student Activity Tracker{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <style>
        {% for student, color in students.items() %}
        student::{{student}}
        color::{{color}}
        {% if color.startswith('#') and color|length == 7 %}

            /* Style the input and label for each student */
            input[type="radio"].student-{{ student|lower }} {
                accent-color: {{ color }}; /* Use the student's color for the radio button */
            }            

            label.student-{{ student|lower }} {
                background-color: {{ color|lighten(0.8) }}; /* Light version of the student's color */
                color: {{ color|darken(0.2) }}; /* Text color */
                border: 1px solid {{ color|darken(0.2) }}; /* Slightly darker border */
                padding: 5px 10px; /* Add padding for better appearance */
                border-radius: 5px; /* Rounded corners */
                display: inline-block; /* Make the label look like a button */
                cursor: pointer; /* Add a pointer cursor for better UX */
            }

            label.student-{{ student|lower }}:hover {
                background-color: {{ color }}; /* Same as the checked color */
                color: white; /* White text on hover */
            }

            /* Style the label when the corresponding input is selected */
            input[type="radio"].student-{{ student|lower }}:checked + label {
                background-color: {{ color }}; /* Even darker version when selected */
                color: white; /* White text when selected */
                border-color: {{ color|darken(0.4) }}; /* Match the border to the background */
            }
        {% endif %}
        {% endfor %}
    </style>
{% endblock %}

{% block menu %}
    <div class="hamburger-menu">
        <!-- Hamburger Icon -->
        <button class="hamburger-icon" onclick="toggleMenu()">
            â˜°
        </button>

        <!-- Hidden Menu -->
        <div id="menu-items" class="menu-items">
            <a href="/daily-report" onclick="openPopup(event, '/daily-report')">Today's Report</a>
            <a href="/full-report" onclick="openPopup(event, '/full-report')">Full Report</a>
            <a href="/admin" onclick="closeMenu()">Admin</a>
            <a href="/logout" onclick="closeMenu()">Logout</a>
        </div>
    </div>

    <script>
        // Toggle the visibility of the menu
        function toggleMenu() {
            const menu = document.getElementById('menu-items');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }

        // Close the menu
        function closeMenu() {
            const menu = document.getElementById('menu-items');
            menu.style.display = 'none';
        }
        
        // Close the menu when clicking anywhere outside the menu
        document.addEventListener('click', function (event) {
            const menu = document.getElementById('menu-items');
            const hamburgerIcon = document.querySelector('.hamburger-icon');
            if (menu.style.display === 'block' && !menu.contains(event.target) && event.target !== hamburgerIcon) {
                menu.style.display = 'none';
            }
        });

        function openPopup(event, url) {
            closeMenu();
            event.preventDefault(); // Prevent default form submission behavior

            // Get the selected student value
            const studentSelect = document.getElementById('student-select');
            const studentValue = studentSelect.value;

                // if (!studentValue) {
                //     alert('Please select a student before proceeding.');
                //     return;
                // }

            // Append the student value to the URL as a query parameter
            const fullUrl = `${url}?student=${encodeURIComponent(studentValue)}`;

            // Open the popup window
            const newWindow = window.open(fullUrl, '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
            if (!newWindow) {
                alert('Popup blocked! Please allow popups for this website.');
            }
        }
    </script>

{% endblock %}
{% block nav %}
    <!-- Dropdown for selecting a student -->
    <form action="/student-daily-report" method="GET" class="student-form">
        <select id="student-select" name="student" required>
            <option value="" disabled selected>Students...</option>
            {% for student in students %}
                <option value="{{ student }}">{{ student }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="button green-button" onclick="openPopup(event, '/student-daily-report')">View Daily</button>
    </form>
{% endblock %}

{% block content %}
<!-- Popup Window -->
<div id="data-popup" class="popup hidden">
    <div class="popup-content">
        <span class="close-button" onclick="closeDataPopup()">&times;</span>
        <h2>Today's Data</h2>
        <div id="data-container">
            <!-- Data will be dynamically loaded here -->
        </div>
    </div>
</div>

<form action="/submit" method="POST">
  <div class="main-window" role="region" aria-label="Main form">
        <!-- Students Section -->
        <div class="section">
            <b>Students</b>
            <div class="button-group">
                {% for student, color in students.items() %}
                    <input type="radio" id="student-{{ student|lower }}" class="student-{{ student|lower }}" name="student" value="{{ student }}">
                    <label for="student-{{ student|lower }}" class="student-{{ student|lower }}">{{ student }}</label>
                {% endfor %}
            </div>
        </div>

        <!-- Times Section -->
        <div class="section">
            <b>Times</b>
            <div class="button-group">
                {% if times %}
                    {% for t in times %}
                    <!-- t = {{t}}
                    times = {{times}} -->
                    <input type="radio" id="time{{ loop.index }}" name="time" value="{{ t }}"
                        {% if t == time %}checked{% endif %}>
                    <label for="time{{ loop.index }}">{{ t }}</label>
                    {% endfor %}
                {% endif %}                    
            </div>
        </div>

        <!-- Column Options and Notes Section -->
        <div class="section">
            <div class="button-group">
                <button type="submit" class="button purple-button ">Save</button>
                {% if column1_options %}
                    {% for key, value in column1_options.items() %}
                    <input type="radio" id="column1{{ loop.index }}" name="column1" value="{{ key }}"
                        {% if key == column1 %}checked{% endif %}>
                    <label for="column1{{ loop.index }}">{{ value }}</label>
                    {% endfor %}
                {% endif %}                    
            </div>

            <hr class="hr-separator">
            <div class="button-group">
                {% if column1_options %}
                    {% for key, value in column2_options.items() %}
                    <input type="radio" id="column2{{ loop.index }}" name="column2" value="{{ key }}"
                        {% if key == column2 %}checked{% endif %}>
                    <label for="column2{{ loop.index }}">{{ value }}</label>
                    {% endfor %}
                {% endif %}                    
            </div>

            <!-- <h2>&nbsp;</h2>
            <div class="button-group">
                {% if column1_options %}
                    {% for key, value in column3_options.items() %}
                    <input type="radio" id="column3{{ loop.index }}" name="column3" value="{{ key }}"
                        {% if key == column3 %}checked{% endif %}>
                    <label for="column3{{ loop.index }}">{{ value }}</label>
                    {% endfor %}
                {% endif %}                    
            </div>

            <h2>&nbsp;</h2>
            <div class="button-group">
                {% if column4_options %}
                    {% for key, value in column4_options.items() %}
                    <input type="radio" id="column4{{ loop.index }}" name="column4" value="{{ key }}"
                        {% if key == column4 %}checked{% endif %}>
                    <label for="column4{{ loop.index }}">{{ value }}</label>
                    {% endfor %}
                {% endif %}                    
            </div> -->

            <textarea name="notes" placeholder="Enter any additional notes here...">{{ notes }}</textarea>
        </div>
    </div>
</form>


{% endblock %}
{% extends 'base.html' %}

{% block title %}Admin Functions{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}

{% block header %}Student Activity Tracker{% endblock %}

{% block date %}<h4>{{ date }}</h4>{% endblock %}

{% block nav %}
<div class="header-buttons">
    <form action="/main" method="GET"><button type="submit" class="button purple-button">Return</button></form>
    <form action="/logout" method="GET"><button type="submit" class="button gray-button">Exit</button></form>
    <form action="/admin/excel" method="POST"><button type="submit" class="button green-button">View Excel</button>
    </form>
    <form action="/todays-report" method="GET">
        <button type="button" class="button green-button " onclick="openRouteInNewWindow('/todays-report')">
            Today's Report</button>

        <script>
            function openRouteInNewWindow(route) {
                const newWindow = window.open(route, '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
                if (!newWindow) {
                    alert('Popup blocked! Please allow popups for this website.');
                }
            }
        </script>
    </form>
    <form action="/admin/clear_excel" method="POST">
        <button type="submit" class="button blue-button">Clear Excel</button>
    </form>
</div>
{% endblock %}

{% block content %}
<div class="window" role="region" aria-label="Admin panels">
    <!-- Students Section -->
    <div class="admin-window">
        <h2>Students</h2>
        <form action="/admin/add_student" method="POST">
            <input type="text" name="student" placeholder="Enter student name" required>

            <!-- Dropdown for Available Colors -->
            <select name="color" required>
                <option value="" disabled selected>Select a color</option>
                {% for color_name, color_value in available_colors.items() %}
                <option value="{{ color_value }}">{{ color_name }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="button green-button">Add</button>
        </form>
        <form action="/admin/remove_student" method="POST" class="form-row">
            <select name="student" required>
                <option value="Select a Student...">Select a Student...</option>
                {% for student in data['students'] %}
                <option value="{{ student }}">{{ student }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="button purple-button">Remove</button>
        </form>
        <hr class="form-separator">

        <!-- Times Section -->
        <h2>Times</h2>
        <form action="/admin/add_time" method="POST">
            <input type="text" name="time" placeholder="Enter time" required>
            <button type="submit" class="button green-button">Add</button>
        </form>
        <form action="/admin/remove_time" method="POST" class="form-row">
            <select name="time" required>
                <option value="Select a time...">Select a time...</option>
                {% for time in data['times'] %}
                <option value="{{ time }}">{{ time }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="button purple-button">Remove</button>
        </form>
        <hr class="form-separator">
    </div>

    <!-- Columns Section -->
    {% for column in ['column1_options', 'column2_options', 'column3_options', 'column4_options'] %}
    <div class="admin-window">
        <!-- Column Header -->
        <h2>&nbsp;</h2>

        <!-- Add Form -->
        <form action="/admin/add_column" method="POST">
            <input type="hidden" name="column_name" value="{{ column }}">
            <input type="text" name="key" placeholder="Enter key..." required>
            <input type="text" name="value" placeholder="Enter value..." required>
            <button type="submit" class="button green-button">Add</button>
        </form>

        <!-- Remove Form -->
        <form action="/admin/remove_column" method="POST">
            <select name="{{ column }}" required>
                <option value="Select an Option...">Select an Option...</option>
                {% for key, value in data[column].items() %}
                <option value="{{ key }}">{{ value }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="button purple-button">Remove</button>
        </form>
        
        <hr class="form-separator">
    </div>
    {% endfor %}
</div>
</div>
{% endblock %}